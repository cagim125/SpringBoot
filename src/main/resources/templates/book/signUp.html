<!doctype html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
        name="viewport">
  <meta content="ie=edge" http-equiv="X-UA-Compatible">
  <title>SignUp</title>
  <link href="/home.css" rel="stylesheet"/>
<!--  <link href="/static/home.css" rel="stylesheet"/>-->
</head>
<body>

<div class="wrapper">
  <div class="signWrap">
    <div th:replace="~{book/nav.html :: navbar}"></div>
    <form action="/api/user/signUp" method="post">
      <h2>회원가입</h2>
      <div th:if="${errorMessage}">
        <h5 style="color:red;" th:text="${errorMessage}"></h5>
      </div>
      <div class="siginUpForm">
        <div>
          <div id="checkUserName"></div>
          <div id="result"></div>
          <input id="username" name="username" placeholder="username" type="text"/>
          <button id="checkUsernameBtn">중복확인</button>
        </div>

        <input name="password" placeholder="password" type="password"/>
        <input name="displayName" placeholder="displayName" type="text"/>
        <button type="submit">회원가입</button>
      </div>

    </form>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script>
  $(document).ready(function() {
           $('#checkUsernameBtn').click(function(e) {
             e.preventDefault(); // 기본 폼 제출 방지
           		 const username = $("#username").val();

           		 if (username == "") {
                  $("#checkUserName").text('Please enter a username.');
                  return;
           		 }

               $.ajax({
                   url: `/api/user/exists/${username}`, // 요청 보낼 URL
                   type: 'GET', // HTTP 메서드 (GET, POST)
                   success: function(data) {
                       // 요청이 성공했을 때 실행할 코드
                       console.log(data);
                        if (data) {
                          $('#result').text('Username is already taken.');
                        } else {
                          $('#result').text('Username is available.');
                        }
                   },
                   error: function(error) {
                       // 요청이 실패했을 때 실행할 코드
                       console.error("Error: " + error);
                        $('#result').text('An error occurred. Please try again.');
                   }
               });
           });
       });

</script>
</body>
</html>